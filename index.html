<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="description" content="ì•„ë¹ ë³„ì˜ ë³„ìë¦¬íŒ(Planisphere)ì…ë‹ˆë‹¤. ë³„ìë¦¬ë¥¼ ì‰½ê²Œ ê³µë¶€í•˜ëŠ” ë° í•„ìš”í•œ êµìœ¡ìë£Œê°€ ë˜ê¸¸ í¬ë§í•©ë‹ˆë‹¤.">
  <meta name="author" content="JI YONG HO">
  <meta name="robots" content="robots">
  <meta name="keywords" content="Planisphere,ë³„ìë¦¬íŒ,ë³„ìë¦¬,ë°¤í•˜ëŠ˜,ì•„ë¹ ë³„,ìš°ì£¼,ì²œë¬¸">
  <meta name="og:site_name" content="ì•„ë¹ ë³„ ë³„ìë¦¬íŒ Planisphere" />
  <meta name="og:title" content="ì•„ë¹ ë³„ ë³„ìë¦¬íŒ Planisphere">
  <meta name="og:type" content="website">
  <meta name="og:description" content="ì•„ë¹ ë³„ì˜ ë³„ìë¦¬íŒ(Planisphere)ì…ë‹ˆë‹¤. ë³„ìë¦¬ë¥¼ ì‰½ê²Œ ê³µë¶€í•˜ëŠ” ë° í•„ìš”í•œ êµìœ¡ìë£Œê°€ ë˜ê¸¸ í¬ë§í•©ë‹ˆë‹¤." />
  <meta property="og:image" content="https://jidolstar.github.io/planisphere-js/ogimage.png">
  <link rel="canonical" href="https://jidolstar.github.io/planisphere-js/">
  <title>ì•„ë¹ ë³„ ë³„ìë¦¬íŒ Planisphere</title>
  <link rel="stylesheet" href="css/common.css">
  <link rel="stylesheet" href="css/control-panel.css">
  <link rel="stylesheet" href="css/modal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/3.2.5/svg.min.js"></script>
</head>

<body>
  <div id="planisphere"></div>

  <!-- ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
  <div class="ps-controls" id="ps-controls">
    <div class="ps-controls-bar" id="ps-controls-bar">
      <button class="ps-bar-btn" id="ps-settings">âš™</button>
      <div class="ps-bar-title">ë‚ ì§œ/ì‹œê°„ ì„¤ì •</div>
      <button class="ps-bar-btn" id="ps-toggle">âˆ’</button>
    </div>
    <div class="ps-controls-body" id="ps-controls-body">
      <div class="row">
        <input type="date" id="ps-date">
        <input type="time" id="ps-time" step="60">
      </div>
      <div class="row">
        <button id="ps-now">ì§€ê¸ˆ</button>
        <button data-preset="21" class="ps-preset">ë°¤ 9ì‹œ</button>
        <button data-preset="0" class="ps-preset">ìì •</button>
      </div>
      <div class="row">
        <div class="ps-adjust-col">
          <span class="ps-adjust-label">ë…„</span>
          <button class="ps-adjust-btn plus" id="year-plus">ï¼‹</button>
          <button class="ps-adjust-btn minus" id="year-minus">âˆ’</button>
        </div>
        <div class="ps-adjust-col">
          <span class="ps-adjust-label">ì›”</span>
          <button class="ps-adjust-btn plus" id="month-plus">ï¼‹</button>
          <button class="ps-adjust-btn minus" id="month-minus">âˆ’</button>
        </div>
        <div class="ps-adjust-col">
          <span class="ps-adjust-label">ì¼</span>
          <button class="ps-adjust-btn plus" id="day-plus">ï¼‹</button>
          <button class="ps-adjust-btn minus" id="day-minus">âˆ’</button>
        </div>
        <div class="ps-adjust-col">
          <span class="ps-adjust-label">ì‹œ</span>
          <button class="ps-adjust-btn plus" id="hour-plus">ï¼‹</button>
          <button class="ps-adjust-btn minus" id="hour-minus">âˆ’</button>
        </div>
        <div class="ps-adjust-col">
          <span class="ps-adjust-label">ë¶„</span>
          <button class="ps-adjust-btn plus" id="minute-plus">ï¼‹</button>
          <button class="ps-adjust-btn minus" id="minute-minus">âˆ’</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ì„¤ì • ëª¨ë‹¬ -->
  <div class="ps-modal" id="ps-modal" style="display:none;">
    <div class="ps-modal-content">
      <div class="ps-modal-header">
        <button id="ps-modal-close">âœ•</button>
        <h2>ì„¤ì •</h2>
      </div>
      <div class="ps-modal-body">
        <p id="ps-welcome-text" style="margin:0; font-size:14px; color:#ccc; display:none; text-align: center;">
          ğŸ‘‹ ì•„ë¹ ë³„ ë³„ìë¦¬íŒì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!<br>
          ì›í•˜ëŠ” í…Œë§ˆë¥¼ ì„ íƒí•´ ì£¼ì‹œê³  ì‚¬ìš©ë²•ì„ ê¼­ í™•ì¸í•´ ì£¼ì„¸ìš”.
        </p>
        <section>
          <h3>í…Œë§ˆ</h3>
          <div class="ps-theme-select">
            <img src="images/theme_default.jpg" alt="ê¸°ë³¸ í…Œë§ˆ" data-theme="default">
            <img src="images/theme_dark.jpg" alt="ë‹¤í¬ í…Œë§ˆ" data-theme="dark">
            <img src="images/theme_light.jpg" alt="ë¼ì´íŠ¸ í…Œë§ˆ" data-theme="light">
          </div>
        </section>

        <section>
          <h3>ì‚¬ìš©ë²•</h3>
          <div id="ps-usage">
            <!-- JSì—ì„œ PC/ëª¨ë°”ì¼ êµ¬ë¶„ í›„ ì±„ì›Œë„£ìŒ -->
          </div>
        </section>

        <section>
          <h3>ì œì‘ì</h3>
          <div>
            <ul>
              <li>ì œì‘ : ì§€ìš©í˜¸</li>
              <li>ì´ë©”ì¼ : <a href="mailto:jidolstar@gmail.com">jidolstar@gmail.com</a></li>
              <li>Github : <a href="https://github.com/jidolstar/planisphere-js"
                  target="_blank">jidolstar/planisphere-js</a></li>
            </ul>
          </div>
        </section>

      </div>
    </div>
  </div>

  <script type="module">
    import Planisphere from './js/src/planisphere.js';

    const version = '1.1.1';
    const isMobile = /Mobi|Android|iPhone|iPad|iPod|Tablet/i.test(navigator.userAgent)

    // ì €ì¥ëœ í…Œë§ˆ ë¶ˆëŸ¬ì˜¤ê¸°
    const savedTheme = localStorage.getItem("planisphereTheme") || "default";
    let initialStyles;
    if (savedTheme === "dark") {
      document.body.style.background = "#000";
      initialStyles = Planisphere.darkStyles;
    } else if (savedTheme === "light") {
      document.body.style.background = "#fff";
      initialStyles = Planisphere.lightStyles;
    } else {
      document.body.style.background = "#777";
      initialStyles = Planisphere.defaultStyles;
    }

    let planisphere = new Planisphere({
      wrapperDomId: '#planisphere',
      currentDate: new Date(),
      lon: 126.98,
      lat: 37.57,
      dgmt: 9,
      styles: initialStyles,
      version: version
    });

    /*********************************
     * ì»¨íŠ¸ë¡¤ íŒ¨ë„ 
     *********************************/

    // --- DOM ìš”ì†Œ ---
    const $date = document.getElementById('ps-date');
    const $time = document.getElementById('ps-time');
    const $now = document.getElementById('ps-now');

    // ê³µí†µ: inputê°’ â†’ Date ë³€í™˜
    function getDateFromInputs() {
      if (!$date.value || !$time.value) return null;
      return new Date(`${$date.value}T${$time.value}`);
    }

    // ì´ˆê¸°ê°’ í˜„ì¬ ì‹œê°„ ë°˜ì˜
    const initNow = () => {
      const now = new Date();
      const pad = n => String(n).padStart(2, '0');
      const Y = now.getFullYear();
      const M = pad(now.getMonth() + 1);
      const D = pad(now.getDate());
      const h = pad(now.getHours());
      const m = pad(now.getMinutes());
      $date.value = `${Y}-${M}-${D}`;
      $time.value = `${h}:${m}`;
      planisphere.setDateTime(now);
    };
    initNow();

    // input ë³€ê²½ ì´ë²¤íŠ¸
    $date.addEventListener('change', () => {
      const dt = getDateFromInputs();
      if (dt) planisphere.setDateTime(dt);
    });
    $time.addEventListener('change', () => {
      const dt = getDateFromInputs();
      if (dt) planisphere.setDateTime(dt);
    });

    // "ì§€ê¸ˆ" ë²„íŠ¼
    $now.addEventListener('click', () => {
      initNow();
    });

    // í”„ë¦¬ì…‹ ë²„íŠ¼ë“¤
    document.querySelectorAll('.ps-preset').forEach(btn => {
      btn.addEventListener('click', () => {
        if (!$date.value) return;
        const [Y, M, D] = $date.value.split('-').map(Number);
        const h = Number(btn.dataset.preset);
        const dt = new Date(Y, M - 1, D, h, 0, 0);
        const pad = n => String(n).padStart(2, '0');
        $time.value = `${pad(h)}:00`;
        planisphere.setDateTime(dt);
      });
    });

    // --- ì¦ê° ë²„íŠ¼ ìœ í‹¸ ---
    function adjust(unit, delta) {
      const dt = getDateFromInputs();
      if (!dt) return;
      switch (unit) {
        case 'year': dt.setFullYear(dt.getFullYear() + delta); break;
        case 'month': dt.setMonth(dt.getMonth() + delta); break;
        case 'day': dt.setDate(dt.getDate() + delta); break;
        case 'hour': dt.setHours(dt.getHours() + delta); break;
        case 'minute': dt.setMinutes(dt.getMinutes() + delta); break;
      }
      const pad = n => String(n).padStart(2, '0');
      const Y = dt.getFullYear();
      const M = pad(dt.getMonth() + 1);
      const D = pad(dt.getDate());
      const h = pad(dt.getHours());
      const m = pad(dt.getMinutes());
      $date.value = `${Y}-${M}-${D}`;
      $time.value = `${h}:${m}`;
      planisphere.setDateTime(dt);
    }

    // ë²„íŠ¼ ë°”ì¸ë”©
    document.getElementById('year-minus').onclick = () => adjust('year', -1);
    document.getElementById('year-plus').onclick = () => adjust('year', +1);
    document.getElementById('month-minus').onclick = () => adjust('month', -1);
    document.getElementById('month-plus').onclick = () => adjust('month', +1);
    document.getElementById('day-minus').onclick = () => adjust('day', -1);
    document.getElementById('day-plus').onclick = () => adjust('day', +1);
    document.getElementById('hour-minus').onclick = () => adjust('hour', -1);
    document.getElementById('hour-plus').onclick = () => adjust('hour', +1);
    document.getElementById('minute-minus').onclick = () => adjust('minute', -1);
    document.getElementById('minute-plus').onclick = () => adjust('minute', +1);


    const controls = document.getElementById("ps-controls");
    const bar = document.getElementById("ps-controls-bar");
    const toggleBtn = document.getElementById("ps-toggle");

    let isCollapsed = false;

    // ì ‘ê¸°/í¼ì¹˜ê¸°
    toggleBtn.addEventListener("click", () => {
      isCollapsed = !isCollapsed;
      controls.classList.toggle("collapsed", isCollapsed);
      toggleBtn.textContent = isCollapsed ? "+" : "âˆ’";
    });

    /*********************************
     * ì„¤ì • ëª¨ë‹¬ 
     *********************************/
    const modal = document.getElementById("ps-modal");
    const modalClose = document.getElementById("ps-modal-close");
    const settingsBtn = document.getElementById("ps-settings");
    const usageDiv = document.getElementById("ps-usage");
    usageDiv.innerHTML = `
  <p>ğŸ“± ìŠ¤ë§ˆíŠ¸í°</p>
  <ul>
    <li>íšŒì „: í•œ ì†ê°€ë½ ë“œë˜ê·¸</li>
    <li>ì´ë™: ë‘ ì†ê°€ë½ ë“œë˜ê·¸</li>
    <li>í™•ëŒ€/ì¶•ì†Œ: í•€ì¹˜ ì œìŠ¤ì²˜</li>
  </ul>
  <p>ğŸ’» PC</p>
  <ul>
    <li>íšŒì „: ë§ˆìš°ìŠ¤ ë“œë˜ê·¸</li>
    <li>ì´ë™: ë§ˆìš°ìŠ¤ ì˜¤ë¥¸ìª½ ë²„íŠ¼ ë“œë˜ê·¸</li>
    <li>í™•ëŒ€/ì¶•ì†Œ: ë§ˆìš°ìŠ¤ íœ </li>
  </ul>
`;

    function openSettingsModal(showWelcome = false) {
      modal.style.display = "flex";
      const welcome = document.getElementById("ps-welcome-text");

      modal.classList.add("open");

      if (showWelcome) {
        welcome.style.display = "block";
      } else {
        welcome.style.display = "none";
      }
    }

    // ì—´ê¸°
    settingsBtn.addEventListener("click", () => {
      openSettingsModal(false);
    });

    // ë‹«ê¸°
    modalClose.addEventListener("click", () => {
      modal.style.display = "none";
    });
    // ESC í‚¤ë¡œ ë‹«ê¸°
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        if (modal.style.display === "block" || modal.classList.contains("open")) {
          modal.style.display = "none";
          modal.classList.remove("open"); // open í´ë˜ìŠ¤ë¥¼ ì“°ëŠ” ê²½ìš° ëŒ€ë¹„
        }
      }
    });

    // í˜ì´ì§€ ë¡œë“œì‹œ ì²« ë°©ë¬¸ í™•ì¸
    window.addEventListener("DOMContentLoaded", () => {
      const firstVisitDone = localStorage.getItem("planisphereFirstVisitDone");
      if (!firstVisitDone) {
        openSettingsModal(true);
        localStorage.setItem("planisphereFirstVisitDone", "true");
      }
    });

    // í…Œë§ˆ ë³€ê²½
    document.querySelectorAll('.ps-theme-select img').forEach(img => {
      if (img.dataset.theme === savedTheme) img.classList.add("active");
      img.addEventListener("click", () => {
        document.querySelectorAll('.ps-theme-select img').forEach(i => i.classList.remove('active'));
        img.classList.add('active');

        const theme = img.dataset.theme;
        localStorage.setItem("planisphereTheme", theme); // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì €ì¥
        if (theme === "dark") {
          document.body.style.background = "#000";
          planisphere.setStyles(Planisphere.darkStyles);
        } else if (theme === "light") {
          document.body.style.background = "#fff";
          planisphere.setStyles(Planisphere.lightStyles);
        } else {
          document.body.style.background = "#777";
          planisphere.setStyles(Planisphere.defaultStyles);
        }
      });
    });

  </script>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FCXVFS01Z7"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-FCXVFS01Z7');
  </script>
</body>

</html>