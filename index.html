<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0, user-scalable=yes"> 
<meta name="description" content="아빠별의 별자리판(Planisphere)입니다. 별자리를 쉽게 공부하는 데 필요한 교육자료가 되길 희망합니다."> 
<meta name="author" content="JI YONG HO"> 
<meta name="robots" content="robots">
<meta name="keywords" content="Planisphere,별자리판,별자리,밤하늘,아빠별,우주,천문"> 
<meta name="og:site_name" content="아빠별 별자리판 Planisphere" />
<meta name="og:title" content="아빠별 별자리판 Planisphere">
<meta name="og:type" content="website">
<meta name="og:description" content="아빠별의 별자리판(Planisphere)입니다. 별자리를 쉽게 공부하는 데 필요한 교육자료가 되길 희망합니다."/>
<meta property="og:image" content="https://jidolstar.github.io/planisphere-js/ogimage.png">
<link rel="canonical" href="https://jidolstar.github.io/planisphere-js/">	
<title>아빠별 별자리판 Planisphere</title>
<style>
html, body { margin:0; padding:0; overflow: hidden; }
svg text{ -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
.ps-controls{
  position:absolute;
  bottom:12px; left:8px; right:8px;
  display:flex; flex-direction:column;
  border-radius:12px;
  background:rgba(0,0,0,.35); backdrop-filter: blur(6px);
  color:#fff; font:14px/1.4 system-ui, -apple-system, Roboto;
  pointer-events:auto;
  transition: height 0.3s ease, width 0.3s ease;
}
.ps-controls .row{ display:flex; gap:8px; flex-wrap:wrap; }
.ps-controls input, .ps-controls button{
  flex:1 1 auto; padding:6px; border-radius:8px; border:1px solid rgba(255,255,255,.2);
  background:rgba(255,255,255,.08); color:#fff;
}
.ps-controls button{ cursor:pointer; }
.ps-controls-bar {
  display:flex; justify-content:space-between; align-items:center;
  padding:4px 6px; background:rgba(0,0,0,.5); border-radius:12px 12px 0 0;
  cursor:grab; height: 28px;
}
.ps-controls-bar:active { cursor:grabbing; }
.ps-bar-btn {  
  flex:0 0 auto !important; 
  display:flex; 
  align-items:center; 
  justify-content:center;
  width:20px; 
  height:20px;
  background:none; 
  border:none; 
  color:#fff; 
  font-size:14px;
  padding:0; 
  cursor:pointer; 
  border-radius:4px;
}
.ps-bar-btn:hover { background:rgba(255,255,255,0.15); }
.ps-bar-title { flex:1; text-align:center; font-weight:600; font-size:13px;}
.ps-controls-body {
  padding:8px; display:flex; flex-direction:column; gap:6px;
  overflow:hidden;transition: max-height 0.3s ease;
}
.ps-controls.collapsed .ps-controls-body { max-height:0; padding:0; margin:0; overflow:hidden;}
.ps-controls.collapsed .ps-controls-bar { border-radius:12px; }
.ps-adjust-col { display:flex; flex-direction:column; align-items:center; flex:1; min-width:50px; gap:4px; }
.ps-adjust-label { font-weight:600; font-size:12px;}
.ps-adjust-btn { width:32px; height:28px; line-height:1; padding:0; border-radius:6px;}
.ps-adjust-btn.minus { background:rgba(255,0,0,.3); }
.ps-adjust-btn.plus  { background:rgba(0,255,0,.3); }
@media (min-width: 920px){
  .ps-controls{ left:12px; right:auto; width:460px; }
  .ps-controls{ left:auto; right:12px; bottom:12px; width:420px; }
}
</style>
<script src="https://cdn.jsdelivr.net/npm/@svgdotjs/svg.js@3.0/dist/svg.min.js"></script>
<script src="astro.js"></script>
<script src="conline.js"></script>
<script src="conname.js"></script>
<script src="stars.js"></script>
<script src="planisphere.js"></script>
</head>
<body>
<div id="planisphere"></div>
<div class="ps-controls" id="ps-controls">
  <div class="ps-controls-bar" id="ps-controls-bar">
    <button class="ps-bar-btn" id="ps-settings">⚙</button>
    <div class="ps-bar-title">별자리판 컨트롤</div>
    <button class="ps-bar-btn" id="ps-toggle">−</button>
  </div>
  <div class="ps-controls-body" id="ps-controls-body">
    <div class="row">
        <input type="date" id="ps-date">
        <input type="time" id="ps-time" step="60">
    </div>
    <div class="row">
        <button id="ps-now">지금</button>
        <button data-preset="21" class="ps-preset">밤 9시</button>
        <button data-preset="0"  class="ps-preset">자정</button>
    </div>
    <div class="row">
        <div class="ps-adjust-col">
        <span class="ps-adjust-label">년</span>
        <button class="ps-adjust-btn plus"  id="year-plus">＋</button>
        <button class="ps-adjust-btn minus" id="year-minus">−</button>
        </div>
        <div class="ps-adjust-col">
        <span class="ps-adjust-label">월</span>
        <button class="ps-adjust-btn plus"  id="month-plus">＋</button>
        <button class="ps-adjust-btn minus" id="month-minus">−</button>
        </div>
        <div class="ps-adjust-col">
        <span class="ps-adjust-label">일</span>
        <button class="ps-adjust-btn plus"  id="day-plus">＋</button>
        <button class="ps-adjust-btn minus" id="day-minus">−</button>
        </div>
        <div class="ps-adjust-col">
        <span class="ps-adjust-label">시</span>
        <button class="ps-adjust-btn plus"  id="hour-plus">＋</button>
        <button class="ps-adjust-btn minus" id="hour-minus">−</button>
        </div>
        <div class="ps-adjust-col">
        <span class="ps-adjust-label">분</span>
        <button class="ps-adjust-btn plus"  id="minute-plus">＋</button>
        <button class="ps-adjust-btn minus" id="minute-minus">−</button>
        </div>
    </div>
  </div>
</div>
<script>
let planisphere = new Planisphere({
    wrapperDomId: '#planisphere',
    currentDate: new Date(),
    lon: 126.98,
    lat: 37.57,
    dgmt: 9,
    styles: {}
});

// --- DOM 요소 ---
const $date = document.getElementById('ps-date');
const $time = document.getElementById('ps-time');
const $now  = document.getElementById('ps-now');

// 공통: input값 → Date 변환
function getDateFromInputs() {
  if(!$date.value || !$time.value) return null;
  return new Date(`${$date.value}T${$time.value}`);
}

// 초기값 현재 시간 반영
const initNow = () => {
    const now = new Date();
    const pad = n => String(n).padStart(2,'0');
    const Y = now.getFullYear();
    const M = pad(now.getMonth()+1);
    const D = pad(now.getDate());
    const h = pad(now.getHours());
    const m = pad(now.getMinutes());
    $date.value = `${Y}-${M}-${D}`;
    $time.value = `${h}:${m}`;
    planisphere.setDateTime(now);
};
initNow();

// input 변경 이벤트
$date.addEventListener('change', ()=> {
    const dt = getDateFromInputs();
    if (dt) planisphere.setDateTime(dt);
});
$time.addEventListener('change', ()=> {
    const dt = getDateFromInputs();
    if (dt) planisphere.setDateTime(dt);
});

// "지금" 버튼
$now.addEventListener('click', ()=> {
    initNow();
});

// 프리셋 버튼들
document.querySelectorAll('.ps-preset').forEach(btn=>{
    btn.addEventListener('click', ()=>{
        if(!$date.value) return;
        const [Y,M,D] = $date.value.split('-').map(Number);
        const h = Number(btn.dataset.preset);
        const dt = new Date(Y, M-1, D, h, 0, 0);
        const pad = n => String(n).padStart(2,'0');
        $time.value = `${pad(h)}:00`;
        planisphere.setDateTime(dt);
    });
});

// --- 증감 버튼 유틸 ---
function adjust(unit, delta) {
    const dt = getDateFromInputs();
    if (!dt) return;
    switch(unit){
        case 'year':  dt.setFullYear(dt.getFullYear()+delta); break;
        case 'month': dt.setMonth(dt.getMonth()+delta); break;
        case 'day':   dt.setDate(dt.getDate()+delta); break;
        case 'hour':  dt.setHours(dt.getHours()+delta); break;
        case 'minute':dt.setMinutes(dt.getMinutes()+delta); break;
    }
    const pad = n => String(n).padStart(2,'0');
    const Y = dt.getFullYear();
    const M = pad(dt.getMonth()+1);
    const D = pad(dt.getDate());
    const h = pad(dt.getHours());
    const m = pad(dt.getMinutes());
    $date.value = `${Y}-${M}-${D}`;
    $time.value = `${h}:${m}`;
    planisphere.setDateTime(dt);
}

// 버튼 바인딩
document.getElementById('year-minus').onclick   = ()=>adjust('year', -1);
document.getElementById('year-plus').onclick    = ()=>adjust('year', +1);
document.getElementById('month-minus').onclick  = ()=>adjust('month', -1);
document.getElementById('month-plus').onclick   = ()=>adjust('month', +1);
document.getElementById('day-minus').onclick    = ()=>adjust('day', -1);
document.getElementById('day-plus').onclick     = ()=>adjust('day', +1);
document.getElementById('hour-minus').onclick   = ()=>adjust('hour', -1);
document.getElementById('hour-plus').onclick    = ()=>adjust('hour', +1);
document.getElementById('minute-minus').onclick = ()=>adjust('minute', -1);
document.getElementById('minute-plus').onclick  = ()=>adjust('minute', +1);


const controls = document.getElementById("ps-controls");
const bar = document.getElementById("ps-controls-bar");
const toggleBtn = document.getElementById("ps-toggle");

let isCollapsed = false;

// 접기/펼치기
toggleBtn.addEventListener("click", () => {
  isCollapsed = !isCollapsed;
  controls.classList.toggle("collapsed", isCollapsed);
  toggleBtn.textContent = isCollapsed ? "+" : "−";
});

// PC에서 드래그 이동
let dragOffsetX = 0, dragOffsetY = 0, dragging = false;

bar.addEventListener("mousedown", (e) => {
  if (window.innerWidth < 920) return; // 모바일 제외
  dragging = true;
  dragOffsetX = e.clientX - controls.offsetLeft;
  dragOffsetY = e.clientY - controls.offsetTop;
  document.body.style.userSelect = "none";
});

window.addEventListener("mousemove", (e) => {
  if (!dragging) return;
  controls.style.left = `${e.clientX - dragOffsetX}px`;
  controls.style.top = `${e.clientY - dragOffsetY}px`;
  controls.style.right = "auto"; // 오른쪽 anchor 해제
  controls.style.bottom = "auto"; // 하단 anchor 해제
});

window.addEventListener("mouseup", () => {
  dragging = false;
  document.body.style.userSelect = "";
});
</script>
</body>
</html>